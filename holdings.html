<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dynamic Holdings & Positions</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 30px; }
        h2 { margin-top: 40px; }
        table { border-collapse: collapse; width: 80%; margin-bottom: 30px; }
        th, td { border: 1px solid #aaa; padding: 8px 12px; text-align: left; }
        th { background: #f0f0f0; }
        tr:nth-child(even) { background: #fafafa; }
    </style>
</head>
<body>
    <h1>My Holdings & Positions</h1>
    <input type="file" id="fileInput" />
    <div id="content"></div>
    <script>
    document.getElementById('fileInput').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function(e) {
            const text = e.target.result;
            // Extract JSON from the output
            const holdingsMatch = text.match(/JSON_HOLDINGS_START\s*([\s\S]*?)\s*JSON_HOLDINGS_END/);
            const positionsMatch = text.match(/JSON_POSITIONS_START\s*([\s\S]*?)\s*JSON_POSITIONS_END/);
            let html = '';
            if (holdingsMatch) {
                let holdings;
                try {
                    holdings = JSON.parse(holdingsMatch[1].trim());
                } catch (err) {
                    html += "<p style='color:red'>Error parsing holdings JSON.</p>";
                }
                if (holdings && Array.isArray(holdings)) {
                    html += '<h2>Holdings</h2><table><tr><th>Symbol</th><th>Quantity</th><th>Average Price</th></tr>';
                    holdings.forEach(h => {
                        html += `<tr><td>${h.tradingsymbol}</td><td>${h.quantity}</td><td>${h.average_price}</td></tr>`;
                    });
                    html += '</table>';
                }
            }
            if (positionsMatch) {
                let positions;
                try {
                    positions = JSON.parse(positionsMatch[1].trim());
                } catch (err) {
                    html += "<p style='color:red'>Error parsing positions JSON.</p>";
                }
                if (positions && Array.isArray(positions)) {
                    html += '<h2>Positions</h2><table><tr><th>Symbol</th><th>Quantity</th><th>Average Price</th></tr>';
                    positions.forEach(p => {
                        html += `<tr><td>${p.tradingsymbol}</td><td>${p.quantity}</td><td>${p.average_price}</td></tr>`;
                    });
                    html += '</table>';
                }
            }
            if (!holdingsMatch && !positionsMatch) {
                html = "<p style='color:red'>No JSON data found in file.</p>";
            }
            document.getElementById('content').innerHTML = html;
        };
        reader.readAsText(file);
    });
    </script>
</body>
</html>